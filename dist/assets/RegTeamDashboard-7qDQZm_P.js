import{k as K,r as i,s as B,c as G,j as e,X as P,M as H,f as T,U as J,l as V,u as W,m as Y,C as Z,d as ee,n as L,o as se,p as te}from"./index-DrbYOPtV.js";import{a as ne,C as re,U as ae,D as le,Q as $}from"./DashboardLayout-DD1STFC1.js";import{S as O,Q as ie}from"./QRScanner-CnHTzi7D.js";import{M as ce}from"./map-pin-DH3aQBG0.js";import{C as de}from"./clock-CYK23m10.js";import{U as oe}from"./user-x-CsRWkp6o.js";import"./heart-C3OgWR3f.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=K("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),xe=x=>{switch(x.toLowerCase()){case"admin":case"sadmin":return e.jsx(re,{className:"h-8 w-8 text-yellow-500"});case"team_leader":case"registration":case"building":case"info_desk":return e.jsx(ne,{className:"h-8 w-8 text-blue-500"});case"volunteer":return e.jsx(J,{className:"h-8 w-8 text-green-500"});default:return e.jsx(T,{className:"h-8 w-8 text-gray-500"})}},ge=x=>{switch(x.toLowerCase()){case"admin":case"sadmin":return"bg-yellow-100 text-yellow-800";case"team_leader":case"registration":case"building":case"info_desk":return"bg-blue-100 text-blue-800";case"volunteer":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},me=x=>x.replace(/_/g," ").replace(/\b\w/g,N=>N.toUpperCase()),he=({isOpen:x,onClose:N,attendee:f,onAction:C,loading:a=!1,mode:n="building",sessionTitle:p})=>{const[c,y]=i.useState(null),[s,S]=i.useState(f);if(i.useEffect(()=>{if(!(s!=null&&s.id))return;console.log("Setting up real-time subscription for attendee:",s.id);const d=B.channel(`attendee_${s.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"users_profiles",filter:`id=eq.${s.id}`},o=>{console.log("Real-time status update:",o),o.new&&S(m=>m?{...m,building_entry:o.new.building_entry,event_entry:o.new.event_entry,building_status:o.new.building_entry?"inside_building":"outside_building",current_status:o.new.event_entry?"inside_event":"outside_event"}:null)}).subscribe();return()=>{console.log("Cleaning up subscription"),B.removeChannel(d)}},[s==null?void 0:s.id]),i.useEffect(()=>{S(f)},[f]),!x||!s)return null;const g=async d=>{y(d);try{await C(d)}finally{y(null)}},v=d=>d?new Date(d).toLocaleString():"Never",R=()=>n==="session"?"Add to Session":"Attendee Details",_=()=>n==="building"?s.building_entry?"inside":"outside":n==="registration"&&s.event_entry?"inside":"outside",h=()=>n==="building"?s.building_entry?"Inside Building":"Outside Building":s.event_entry?"Inside Event":"Outside Event",k=()=>{let d=!1;return n==="building"?d=s.building_entry||!1:d=s.event_entry||!1,d?"bg-green-100 text-green-800":"bg-red-100 text-red-800"},j=()=>{if(n==="session"){const l=s.building_entry;return e.jsxs("div",{className:"pt-4 fade-in-blur",children:[!l&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3 fade-in-blur",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Attendee must be inside the building to join a session"})]})}),e.jsx("button",{onClick:()=>g("enter"),disabled:a||c!==null||!l,className:`w-full flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-all duration-300 ${l?c==="enter"?"bg-green-100 text-green-700 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:c==="enter"?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-600"}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-5 w-5"}),e.jsx("span",{children:l?"Add to Session":"Cannot Add to Session"})]})}),p&&e.jsx("p",{className:"text-sm text-gray-600 text-center mt-2",children:l?e.jsxs(e.Fragment,{children:["Adding to: ",e.jsx("span",{className:"font-medium",children:p})]}):e.jsxs("span",{className:"text-red-600",children:["Session: ",p]})}),e.jsx("div",{className:"mt-3 text-center fade-in-blur",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${s.building_entry?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-2 ${s.building_entry?"bg-green-500":"bg-red-500"}`}),s.building_entry?"Inside Building":"Outside Building"]})})]})}const o=_()==="inside";let m=o||a||c!==null,w="";n==="building"&&(s.event_entry||(m=!0,w="Must be inside event first"));const A=!o||a||c!==null;return e.jsxs("div",{className:"space-y-3 fade-in-blur",children:[n==="building"&&!s.event_entry&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 fade-in-blur",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-amber-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("p",{className:"text-sm text-amber-800 font-medium",children:"Attendee must be inside event before entering building"})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>g("enter"),disabled:m,title:w,className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-all duration-300 ${m?"bg-gray-200 text-gray-400 cursor-not-allowed":c==="enter"?"bg-green-100 text-green-700 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white"}`,children:c==="enter"?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-600"}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-5 w-5"}),e.jsx("span",{children:"Enter"})]})}),e.jsx("button",{onClick:()=>g("exit"),disabled:A,className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-all duration-300 ${A?"bg-gray-200 text-gray-400 cursor-not-allowed":c==="exit"?"bg-red-100 text-red-700 cursor-not-allowed":"bg-red-500 hover:bg-red-600 text-white"}`,children:c==="exit"?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-red-600"}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-5 w-5"}),e.jsx("span",{children:"Exit"})]})})]})]})};return G.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[200] p-4 modal-backdrop-blur",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content-blur fade-in-up-blur",children:e.jsxs("div",{className:"p-6 stagger-children",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 fade-in-blur",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:R()}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:a||c!==null,children:e.jsx(P,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 fade-in-blur",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-gray-50 rounded-full",children:xe(s.role)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1 flex-wrap",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ge(s.role)}`,children:me(s.role)}),n==="building"&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.event_entry?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${s.event_entry?"bg-blue-500":"bg-gray-500"}`}),s.event_entry?"Inside Event":"Outside Event"]}),e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${k()}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${s.building_entry?"bg-green-500":"bg-red-500"}`}),h()]})]}),n!=="building"&&e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${k()}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${n==="registration"?s.event_entry?"bg-green-500":"bg-red-500":s.building_entry?"bg-green-500":"bg-red-500"}`}),n==="session"?s.building_entry?"Inside Building":"Outside Building":h()]})]})]})]}),e.jsxs("div",{className:"space-y-3 fade-in-blur",children:[e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(H,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(ue,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s.phone})]}),e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(T,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded",children:["ID: ",s.personal_id]})]}),s.university&&e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(ce,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:s.university}),s.faculty&&e.jsx("div",{className:"text-gray-500 text-xs",children:s.faculty})]})]}),s.last_scan&&n==="building"&&e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(de,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("div",{className:"text-sm",children:e.jsxs("div",{children:["Last Scan: ",v(s.last_scan)]})})]})]}),j(),(n==="building"||n==="registration")&&e.jsx("div",{className:"text-xs text-gray-500 text-center bg-gray-50 p-3 rounded-lg fade-in-blur",children:n==="building"?e.jsxs("p",{children:[e.jsx("strong",{children:"Building Entry Requirements:"}),e.jsx("br",{}),"1. Must be inside event first",e.jsx("br",{}),"2. Must be outside building",e.jsx("br",{}),e.jsx("strong",{children:"Exit:"})," Available when inside building"]}):e.jsxs("p",{children:[e.jsx("strong",{children:"Enter:"})," Available when outside event •",e.jsx("strong",{children:"Exit:"})," Available when inside event"]})})]})]})})}),document.body)},D=x=>({...x,current_status:x.event_entry?"inside":"outside"}),we=()=>{W();const[x,N]=i.useState(!1),[f,C]=i.useState("manual"),[a,n]=i.useState(""),[p,c]=i.useState(!1),[y,s]=i.useState([]),[S,g]=i.useState(!1),[v,R]=i.useState(null),[_,h]=i.useState(null),[k,j]=i.useState(!1),[d,o]=i.useState(!1),[m,w]=i.useState(null);i.useEffect(()=>{if(v&&clearTimeout(v),a.trim().length>=2){const t=setTimeout(()=>{A(a.trim())},300);R(t)}else s([]),g(!1);return()=>{v&&clearTimeout(v)}},[a]);const A=async t=>{try{c(!0);const{data:r,error:b}=await Y(t);if(b)console.error("Search error:",b),s([]);else{const u=(r||[]).map(I=>D(I));s(u),g(!0)}}catch(r){console.error("Search exception:",r),s([])}finally{c(!1)}},l=(t,r)=>{w({type:t,message:r}),setTimeout(()=>w(null),5e3)},U=t=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t),Q=async()=>{if(!a.trim()){l("error","Please enter a Personal ID");return}try{c(!0);const{data:t,error:r}=await L(a.trim());r||!t?l("error","Personal ID not found"):t.role!=="attendee"?l("error","Only attendees can be processed through this system"):(h(D(t)),j(!0),n(""),g(!1))}catch(t){console.error("Search exception:",t),l("error","Search failed. Please try again.")}finally{c(!1)}},F=t=>{h(t),j(!0),n(""),g(!1),s([])},M=async t=>{try{console.log("Processing QR data:",t);let r=null,b;if(U(t)){console.log("Detected UUID format, searching by UUID...");const u=await se(t);r=u.data?D(u.data):null,b=u.error}else{console.log("Detected Personal ID format, searching by Personal ID...");const u=await L(t);r=u.data?D(u.data):null,b=u.error}if(b||!r){const u=U(t)?"Invalid QR code: UUID not found in system":"Invalid QR code: Personal ID not found";l("error",u);return}if(r.role!=="attendee"){l("error","Only attendees can be processed through this system");return}h(r),j(!0)}catch(r){console.error("QR scan error:",r),l("error","Failed to process QR code")}},z=()=>{console.log("Scanner closing from parent..."),N(!1)},q=async t=>{if(_)try{o(!0);const{data:r,error:b}=await te(_.personal_id,t);if(b){l("error",b.message||`Failed to process ${t}`);return}l("success",r.message||`${t.toUpperCase()} scan successful!`);const u=t==="enter"?"inside":"outside";h(I=>I?{...I,current_status:u,last_scan:new Date().toISOString()}:null),setTimeout(()=>{j(!1),h(null)},2e3)}catch(r){console.error("Attendance action error:",r),l("error",`Failed to process ${t}`)}finally{o(!1)}},E=()=>{n(""),s([]),g(!1)},X=()=>{setTimeout(()=>{g(!1)},200)};return e.jsxs(le,{title:"Registration Team Dashboard",subtitle:"Manage attendee registrations and check-ins",children:[m&&e.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center space-x-2 px-4 py-3 rounded-lg shadow-lg ${m.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[m.type==="success"?e.jsx(Z,{className:"h-5 w-5"}):e.jsx(ee,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:m.message}),e.jsx("button",{onClick:()=>w(null),className:"ml-2 hover:bg-black hover:bg-opacity-20 rounded p-1",children:e.jsx(P,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("button",{onClick:()=>{C("manual"),E()},className:`px-6 py-3 rounded-lg font-medium transition-colors ${f==="manual"?"bg-orange-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(O,{className:"h-4 w-4 inline mr-2"}),"Search by Personal ID"]}),e.jsxs("button",{onClick:()=>{C("qr"),E()},className:`px-6 py-3 rounded-lg font-medium transition-colors ${f==="qr"?"bg-orange-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx($,{className:"h-4 w-4 inline mr-2"}),"QR Scanner"]})]}),f==="manual"&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Attendees by Personal ID"}),e.jsxs("div",{className:"flex items-center space-x-3 relative",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Start typing Personal ID (e.g., 123456...)",value:a,onChange:t=>n(t.target.value),onKeyDown:t=>t.key==="Enter"&&Q(),onBlur:X,onFocus:()=>y.length>0&&g(!0),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-colors"}),a&&e.jsx("button",{onClick:E,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(P,{className:"h-5 w-5"})}),S&&y.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto",children:y.map(t=>e.jsx("button",{onClick:()=>F(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0 focus:bg-orange-50 focus:outline-none",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[t.first_name," ",t.last_name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",t.personal_id]}),t.university&&e.jsx("p",{className:"text-xs text-gray-500",children:t.university})]}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.current_status==="inside"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.current_status==="inside"?"Inside":"Outside"})})]})},t.id))}),S&&y.length===0&&a.trim().length>=2&&!p&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 px-4 py-3",children:e.jsxs("p",{className:"text-gray-600 text-sm",children:['No attendees found matching "',a,'"']})}),p&&a.trim().length>=2&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-500"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Searching attendees..."})]})})]}),e.jsx("button",{onClick:Q,disabled:p||!a.trim(),className:"px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:p?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-5 w-5"}),e.jsx("span",{children:"Search"})]})})]})]})})}),f==="qr"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 text-center",children:[e.jsx($,{className:"h-16 w-16 text-orange-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"QR Code Scanner"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Scan the attendee's QR code to instantly load their information and process entry/exit"}),e.jsxs("button",{onClick:()=>N(!0),className:"px-8 py-4 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors font-medium flex items-center space-x-2 mx-auto",children:[e.jsx($,{className:"h-5 w-5"}),e.jsx("span",{children:"Open QR Scanner"})]})]})]}),e.jsx(ie,{isOpen:x,onClose:z,onScan:M,title:"Scan Attendee QR Code",description:"Point your camera at the attendee's QR code"}),e.jsx(he,{isOpen:k,onClose:()=>{j(!1),h(null)},attendee:_,onAction:q,loading:d,mode:"registration"})]})};export{we as RegTeamDashboard};

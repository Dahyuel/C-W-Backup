import{o as me,u as he,r as a,j as e,C as ge,A as fe,U as pe,w as be,s as c}from"./index-CyW5l0GB.js";import{D as je,X as N,Q as ye,B as ve}from"./DashboardLayout-DUzv1ASr.js";import{Q as Ne,S as we}from"./QRScanner-BV5V1Uqi.js";import{M as _e,P as Se}from"./plus-8Sno4iOU.js";import"./heart-D9xwhhE9.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=me("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Me=()=>{const{profile:l}=he(),[h,g]=a.useState(!1),[X,F]=a.useState(!1),[d,A]=a.useState(null),[J,R]=a.useState(!1),[Ce,D]=a.useState(!1),[K,z]=a.useState(!1),[W,S]=a.useState(!1),[I,L]=a.useState(""),[B,Q]=a.useState(""),[x,$]=a.useState(""),[f,M]=a.useState([]),[Z,P]=a.useState(""),[E,p]=a.useState([]),[ee,q]=a.useState(!1),[se,k]=a.useState(!1),[b,O]=a.useState(5),[te,j]=a.useState(""),[G,T]=a.useState([]),[o,w]=a.useState(null),[H,y]=a.useState(!1),[i,ae]=a.useState({inside_building:0,inside_event:0,total_attendees:0}),[C,U]=a.useState(null),r=(s,t)=>{U({type:s,message:t}),setTimeout(()=>U(null),5e3)},Y=async()=>{try{const{data:s,error:t}=await be();!t&&s&&ae({inside_building:s.inside_building,inside_event:s.inside_event,total_attendees:s.total_attendees})}catch(s){console.error("Error fetching building stats:",s)}};a.useEffect(()=>{Y();const s=setInterval(Y,3e4);return()=>clearInterval(s)},[]);const le=async s=>{try{console.log("Processing QR data:",s);let t=null;if(s.includes("-")){const{data:m,error:V}=await c.from("users_profiles").select("*").eq("id",s.trim()).single();!V&&m&&(t=m)}else{const{data:m,error:V}=await c.from("users_profiles").select("*").eq("volunteer_id",s.trim()).single();!V&&m&&(t=m)}if(!t){r("error","Volunteer not found");return}if(t.role==="attendee"||t.role==="admin"){r("error","You Are Not A Volunteer");return}const n=new Date;n.setHours(0,0,0,0);const{data:v,error:u}=await c.from("attendances").select("*").eq("user_id",t.id).eq("scan_type","vol_attendance").gte("scanned_at",n.toISOString()).limit(1);!u&&v&&v.length>0?z(!0):z(!1),A(t),D(!0),R(!0)}catch(t){console.error("QR scan error:",t),r("error","Failed to process QR code")}},re=async()=>{if(d)try{g(!0);const{error:s}=await c.from("attendances").insert([{user_id:d.id,scan_type:"vol_attendance",scanned_by:l==null?void 0:l.id}]);if(s){r("error","Failed to record attendance");return}r("success","Attendance recorded successfully!"),R(!1),A(null),D(!1)}catch(s){console.error("Attendance action error:",s),r("error","Failed to record attendance")}finally{g(!1)}},ne=async s=>{if(!s||s.trim().length<2){p([]);return}q(!0);try{const{data:t,error:n}=await c.from("users_profiles").select("id, first_name, last_name, personal_id, role, email, volunteer_id").ilike("personal_id",`%${s.trim()}%`).order("personal_id").limit(10);if(n)console.error("Search error:",n),p([]);else{const v=(t||[]).filter(u=>!f.some(m=>m.id===u.id)&&u.role!=="admin"&&u.role!=="attendee"&&u.id!==(l==null?void 0:l.id));p(v)}}catch(t){console.error("Search exception:",t),p([])}finally{q(!1)}},ie=s=>{M(t=>[...t,s]),p(t=>t.filter(n=>n.id!==s.id)),P("")},oe=s=>{M(t=>t.filter(n=>n.id!==s))},_=()=>{M([]),P(""),p([])},ce=async()=>{if(!I||!B||!x){r("error","Please fill all required fields!");return}if(x==="custom"&&f.length===0){r("error","Please select at least one user for custom announcements!");return}g(!0);try{let s={title:I,message:B,created_by:l==null?void 0:l.id};x==="all"?(s.target_type="role",s.target_role="all_except_admin_attendees"):x==="custom"?(s.target_type="specific_users",s.target_user_ids=f.map(n=>n.id)):(s.target_type="role",s.target_role=x);const{error:t}=await c.from("notifications").insert([s]);t?(console.error("Notification error:",t),r("error","Failed to send announcement")):(r("success","Announcement sent successfully!"),S(!1),L(""),Q(""),$(""),_())}catch(s){console.error("Send announcement error:",s),r("error","Failed to send announcement")}finally{g(!1)}},de=async s=>{if(!s.trim()){T([]);return}try{const{data:t,error:n}=await c.from("users_profiles").select("*").or(`personal_id.ilike.%${s}%,volunteer_id.ilike.%${s}%`).neq("role","admin").neq("role","attendee").limit(10);if(!n&&t){const v=t.filter(u=>u.id!==(l==null?void 0:l.id));T(v),y(!0)}}catch(t){console.error("Search error:",t),T([])}},ue=async()=>{if(!o||b<1){r("error","Please select a user and set bonus amount");return}g(!0);try{const{error:s}=await c.from("user_scores").insert([{user_id:o.id,points:b,activity_type:"vol_bonus",activity_description:"Bonus points assigned by team leader",awarded_by:l==null?void 0:l.id}]);if(s)r("error","Failed to assign bonus");else{const{data:t}=await c.from("users_profiles").select("score").eq("id",o.id).single();t&&await c.from("users_profiles").update({score:(t.score||0)+b}).eq("id",o.id),r("success",`Bonus of ${b} points assigned successfully!`),k(!1),w(null),j(""),O(5)}}catch{r("error","Failed to assign bonus")}finally{g(!1)}},xe=[{value:"all",label:"All Volunteers & Team Leaders"},{value:"volunteer",label:"Volunteers"},{value:"registration",label:"Registration Team"},{value:"building",label:"Building Team"},{value:"info_desk",label:"Info Desk Team"},{value:"team_leader",label:"Team Leaders"},{value:"custom",label:"Custom Selection"}];return e.jsxs(je,{title:"Team Leader Dashboard",subtitle:"Manage your team, track attendance, and assign bonuses",children:[e.jsxs("div",{className:"space-y-8",children:[C&&e.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center space-x-2 px-4 py-3 rounded-lg shadow-lg ${C.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[C.type==="success"?e.jsx(ge,{className:"h-5 w-5"}):e.jsx(fe,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:C.message}),e.jsx("button",{onClick:()=>U(null),className:"ml-2 hover:bg-black hover:bg-opacity-20 rounded p-1",children:e.jsx(N,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2 mb-8",children:[e.jsx(pe,{className:"h-8 w-8 text-orange-500"}),"Manage Your Team"]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:()=>F(!0),className:"flex-1 flex flex-col items-center justify-center py-6 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors",children:[e.jsx(ye,{className:"h-8 w-8 mb-2"}),e.jsx("span",{className:"text-base font-medium",children:"Scan Attendance"})]}),e.jsxs("button",{onClick:()=>k(!0),className:"flex-1 flex flex-col items-center justify-center py-6 px-4 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors",children:[e.jsx(ke,{className:"h-8 w-8 mb-2"}),e.jsx("span",{className:"text-base font-medium",children:"Assign Bonus"})]}),e.jsxs("button",{onClick:()=>S(!0),className:"flex-1 flex flex-col items-center justify-center py-6 px-4 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition-colors",children:[e.jsx(_e,{className:"h-8 w-8 mb-2"}),e.jsx("span",{className:"text-base font-medium",children:"Send Announcement"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50",children:e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2 mx-auto",children:[e.jsx(ve,{className:"h-7 w-7 text-orange-500"}),"Flow Dashboard"]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 px-6 py-6 text-center",children:[e.jsxs("div",{className:"bg-green-100 p-4 rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-green-900",children:i.inside_building}),e.jsx("p",{className:"text-lg font-bold text-gray-700",children:"Inside Building"})]}),e.jsxs("div",{className:"bg-teal-100 p-4 rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-teal-900",children:i.inside_event}),e.jsx("p",{className:"text-lg font-bold text-gray-700",children:"Inside Event"})]}),e.jsxs("div",{className:"bg-blue-100 p-4 rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:i.total_attendees}),e.jsx("p",{className:"text-lg font-bold text-gray-700",children:"Total Attendees"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-lg font-bold text-left border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-800 text-xl font-extrabold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Site"}),e.jsx("th",{className:"px-4 py-3",children:"Maximum Capacity"}),e.jsx("th",{className:"px-4 py-3",children:"Current Capacity"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:"Building"}),e.jsx("td",{className:"px-4 py-3 text-red-600",children:"500"}),e.jsxs("td",{className:"px-4 py-3",children:[i.inside_building>0?Math.round(i.inside_building/500*100):0,"%"]})]}),e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:"Event"}),e.jsx("td",{className:"px-4 py-3 text-red-600",children:"4000"}),e.jsxs("td",{className:"px-4 py-3",children:[i.inside_event>0?Math.round(i.inside_event/4e3*100):0,"%"]})]}),e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:"Total"}),e.jsx("td",{className:"px-4 py-3 text-red-600",children:"4500"}),e.jsxs("td",{className:"px-4 py-3",children:[i.inside_building+i.inside_event>0?Math.round((i.inside_building+i.inside_event)/4500*100):0,"%"]})]})]})]})})})]})]}),e.jsx(Ne,{isOpen:X,onClose:()=>F(!1),onScan:le,title:"Scan Volunteer QR Code",description:"Point your camera at the volunteer's QR code"}),J&&d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Volunteer Information"}),e.jsx("button",{onClick:()=>{R(!1),A(null),D(!1)},className:"text-gray-500 hover:text-gray-700",children:e.jsx(N,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsxs("span",{children:[d.first_name," ",d.last_name]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Volunteer ID:"}),e.jsx("span",{children:d.volunteer_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{children:d.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Personal ID:"}),e.jsx("span",{children:d.personal_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Role:"}),e.jsx("span",{className:"capitalize",children:d.role.replace("_"," ")})]})]}),e.jsx("div",{className:"mt-6",children:K?e.jsx("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg",children:e.jsx("p",{className:"font-medium",children:"This volunteer has already attended today."})}):e.jsx("button",{onClick:re,disabled:h,className:"w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 disabled:opacity-50 transition-colors font-medium",children:h?"Recording...":"Mark Attendance"})})]})}),W&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto relative",children:[e.jsx("button",{onClick:()=>{S(!1),_()},className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700",children:e.jsx(N,{className:"h-6 w-6"})}),e.jsx("h2",{className:"text-lg font-semibold text-black mb-4 text-center",children:"Send Announcement"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:I,onChange:s=>L(s.target.value),placeholder:"Message Title",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),e.jsx("textarea",{value:B,onChange:s=>Q(s.target.value),placeholder:"Message Description",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500",rows:3}),e.jsxs("select",{value:x,onChange:s=>{$(s.target.value),s.target.value!=="custom"&&_()},className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[e.jsx("option",{value:"",children:"Select Target Role"}),xe.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),x==="custom"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Z,onChange:s=>{P(s.target.value),ne(s.target.value)},placeholder:"Search by Personal ID...",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),ee&&e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})})]}),E.length>0&&e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-lg",children:E.map(s=>e.jsx("div",{onClick:()=>ie(s),className:"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",s.personal_id," | ",s.role]})]}),e.jsx(Se,{className:"h-4 w-4 text-blue-500"})]})},s.id))}),f.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Selected Users (",f.length,")"]}),e.jsx("button",{onClick:_,className:"text-xs text-red-500 hover:text-red-700",children:"Clear All"})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-lg bg-gray-50",children:f.map(s=>e.jsxs("div",{className:"p-2 flex justify-between items-center border-b last:border-b-0",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",s.personal_id]})]}),e.jsx("button",{onClick:()=>oe(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(N,{className:"h-4 w-4"})})]},s.id))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{S(!1),_()},className:"px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:ce,disabled:h,className:"px-4 py-2 rounded-lg bg-purple-500 text-white hover:bg-purple-600 disabled:opacity-50",children:h?"Sending...":"Send"})]})]})}),se&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-full max-w-md relative",children:[e.jsx("button",{onClick:()=>{k(!1),w(null),j(""),y(!1)},className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 z-30",children:e.jsx(N,{className:"h-6 w-6"})}),e.jsx("h2",{className:"text-lg font-semibold text-black mb-4 text-center",children:"Assign Bonus Points"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Bonus Points: ",b]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{children:"1"}),e.jsx("input",{type:"range",min:"1",max:"30",value:b,onChange:s=>O(parseInt(s.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),e.jsx("span",{children:"30"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Volunteer"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:te,onChange:s=>{j(s.target.value),de(s.target.value)},onFocus:()=>y(!0),placeholder:"Search by Personal ID or Volunteer ID",className:"w-full border rounded-lg px-3 py-2 pr-10 focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsx(we,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400"}),H&&G.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-40 max-h-60 overflow-y-auto",children:G.map(s=>e.jsx("button",{onClick:()=>{w(s),j(`${s.first_name} ${s.last_name} (${s.volunteer_id})`),y(!1)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0 transition-colors",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",s.volunteer_id," | Personal ID: ",s.personal_id]}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s.role.replace("_"," ")})]})},s.id))})]}),H&&e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>y(!1)})]}),o&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-green-900",children:[o.first_name," ",o.last_name]}),e.jsxs("p",{className:"text-sm text-green-700",children:[o.volunteer_id," • ",o.personal_id]})]}),e.jsx("button",{onClick:()=>{w(null),j("")},className:"text-green-600 hover:text-green-800",children:e.jsx(N,{className:"h-4 w-4"})})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{k(!1),w(null),j(""),y(!1)},className:"px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:ue,disabled:h||!o,className:"px-4 py-2 rounded-lg bg-green-500 text-white hover:bg-green-600 disabled:opacity-50",children:h?"Assigning...":"Assign Bonus"})]})]})})]})};export{Me as TeamLeaderDashboard};

import{o as v,r as c,s as y,j as e,d as N,U as A}from"./index-Ckz-BoSJ.js";import{X as S,a as $,C as L,U}from"./DashboardLayout-Bi1zi9ew.js";import{M as I}from"./map-pin-DUQhGtuq.js";import{C as D}from"./clock-vSob_-fG.js";import{U as M,a as R}from"./user-x-BWSZYqB1.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=v("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=v("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),F=l=>{switch(l.toLowerCase()){case"admin":case"sadmin":return e.jsx(L,{className:"h-8 w-8 text-yellow-500"});case"team_leader":case"registration":case"building":case"info_desk":return e.jsx($,{className:"h-8 w-8 text-blue-500"});case"volunteer":return e.jsx(A,{className:"h-8 w-8 text-green-500"});default:return e.jsx(N,{className:"h-8 w-8 text-gray-500"})}},O=l=>{switch(l.toLowerCase()){case"admin":case"sadmin":return"bg-yellow-100 text-yellow-800";case"team_leader":case"registration":case"building":case"info_desk":return"bg-blue-100 text-blue-800";case"volunteer":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},q=l=>l.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase()),J=({isOpen:l,onClose:x,attendee:o,onAction:w,loading:d=!1,mode:t="building",sessionTitle:g})=>{const[r,m]=c.useState(null),[s,b]=c.useState(o);if(c.useEffect(()=>{if(!(s!=null&&s.id))return;console.log("Setting up real-time subscription for attendee:",s.id);const n=y.channel(`attendee_${s.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"users_profiles",filter:`id=eq.${s.id}`},i=>{console.log("Real-time status update:",i),i.new&&b(a=>a?{...a,building_entry:i.new.building_entry,event_entry:i.new.event_entry,building_status:i.new.building_entry?"inside_building":"outside_building",current_status:i.new.event_entry?"inside_event":"outside_event"}:null)}).subscribe();return()=>{console.log("Cleaning up subscription"),y.removeChannel(n)}},[s==null?void 0:s.id]),c.useEffect(()=>{b(o)},[o]),!l||!s)return null;const u=async n=>{m(n);try{await w(n)}finally{m(null)}},_=n=>n?new Date(n).toLocaleString():"Never",k=()=>t==="session"?"Add to Session":"Attendee Details",C=()=>t==="building"?s.building_entry?"inside":"outside":t==="registration"&&s.event_entry?"inside":"outside",h=()=>t==="building"?s.building_entry?"Inside Building":"Outside Building":s.event_entry?"Inside Event":"Outside Event",f=()=>{let n=!1;return t==="building"?n=s.building_entry||!1:n=s.event_entry||!1,n?"bg-green-100 text-green-800":"bg-red-100 text-red-800"},E=()=>{if(t==="session")return e.jsxs("div",{className:"pt-4",children:[e.jsx("button",{onClick:()=>u("enter"),disabled:d||r!==null,className:`w-full flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-colors ${r==="enter"?"bg-green-100 text-green-700 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white"}`,children:r==="enter"?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-600"}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-5 w-5"}),e.jsx("span",{children:"Add to Session"})]})}),g&&e.jsxs("p",{className:"text-sm text-gray-600 text-center mt-2",children:["Adding to: ",e.jsx("span",{className:"font-medium",children:g})]})]});const i=C()==="inside";let a=i||d||r!==null,j="";t==="building"&&(s.event_entry||(a=!0,j="Must be inside event first"));const p=!i||d||r!==null;return e.jsxs("div",{className:"space-y-3",children:[t==="building"&&!s.event_entry&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-amber-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("p",{className:"text-sm text-amber-800 font-medium",children:"Attendee must be inside event before entering building"})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>u("enter"),disabled:a,title:j,className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-colors ${a?"bg-gray-200 text-gray-400 cursor-not-allowed":r==="enter"?"bg-green-100 text-green-700 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white"}`,children:r==="enter"?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-600"}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx("span",{children:"Enter"})]})}),e.jsx("button",{onClick:()=>u("exit"),disabled:p,className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-colors ${p?"bg-gray-200 text-gray-400 cursor-not-allowed":r==="exit"?"bg-red-100 text-red-700 cursor-not-allowed":"bg-red-500 hover:bg-red-600 text-white"}`,children:r==="exit"?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-red-600"}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-5"}),e.jsx("span",{children:"Exit"})]})})]})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:k()}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",disabled:d||r!==null,children:e.jsx(S,{className:"h-5 w-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-gray-50 rounded-full",children:F(s.role)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1 flex-wrap",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${O(s.role)}`,children:q(s.role)}),t==="building"&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.event_entry?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${s.event_entry?"bg-blue-500":"bg-gray-500"}`}),s.event_entry?"Inside Event":"Outside Event"]}),e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f()}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${s.building_entry?"bg-green-500":"bg-red-500"}`}),h()]})]}),t!=="building"&&e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f()}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${s.event_entry?"bg-green-500":"bg-red-500"}`}),h()]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(P,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(B,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s.phone})]}),e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(N,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded",children:["ID: ",s.personal_id]})]}),s.university&&e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(I,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:s.university}),s.faculty&&e.jsx("div",{className:"text-gray-500 text-xs",children:s.faculty})]})]}),s.last_scan&&t==="building"&&e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(D,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("div",{className:"text-sm",children:e.jsxs("div",{children:["Last Scan: ",_(s.last_scan)]})})]})]}),E(),(t==="building"||t==="registration")&&e.jsx("div",{className:"text-xs text-gray-500 text-center bg-gray-50 p-3 rounded-lg",children:t==="building"?e.jsxs("p",{children:[e.jsx("strong",{children:"Building Entry Requirements:"}),e.jsx("br",{}),"1. Must be inside event first",e.jsx("br",{}),"2. Must be outside building",e.jsx("br",{}),e.jsx("strong",{children:"Exit:"})," Available when inside building"]}):e.jsxs("p",{children:[e.jsx("strong",{children:"Enter:"})," Available when outside event â€¢",e.jsx("strong",{children:"Exit:"})," Available when inside event"]})})]})]})})};export{J as A};

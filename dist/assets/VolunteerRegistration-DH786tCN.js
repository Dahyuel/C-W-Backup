import{a as O,u as q,r as m,j as e,C as E,A as H,R as Y,d as J,e as K,f as Q,s as W,v as I,h as Z,i as ee,F as ae,U as re}from"./index-DrbYOPtV.js";import{H as w}from"./heart-C3OgWR3f.js";const te=()=>{const h=O(),{user:i,profile:l,isAuthenticated:x,loading:f,getRoleBasedRedirect:v,refreshProfile:N}=q(),[n,j]=m.useState(1),[r,y]=m.useState({firstName:"",lastName:"",phone:"",personalId:"",faculty:"",role:"",gender:"",tlTeam:""}),[_,u]=m.useState([]),[T,S]=m.useState(!1),[R,D]=m.useState(!1),[F,b]=m.useState(!1),p=[{id:1,title:"Personal Information",icon:Q},{id:2,title:"Role Selection",icon:w}],A=[{value:"registration",label:"Registration Desk"},{value:"building",label:"Building Assistance"},{value:"info_desk",label:"Info Desk"},{value:"ushers",label:"Ushers"},{value:"marketing",label:"Marketing"},{value:"media",label:"Media"},{value:"ER",label:"ER Team"},{value:"BD team",label:"BD Team"},{value:"catering",label:"Catering"},{value:"feedback",label:"Feedback Team"},{value:"stage",label:"Stage Team"},{value:"team_leader",label:"Team Leader"}],$=[{value:"registration",label:"Registration Team"},{value:"building",label:"Building Team"},{value:"info_desk",label:"Info Desk Team"},{value:"ushers",label:"Ushers Team"},{value:"marketing",label:"Marketing Team"},{value:"media",label:"Media Team"},{value:"ER",label:"ER Team"},{value:"BD team",label:"BD Team"},{value:"catering",label:"Catering Team"},{value:"feedback",label:"Feedback Team"},{value:"stage",label:"Stage Team"}],L=[{value:"male",label:"Male"},{value:"female",label:"Female"}];m.useEffect(()=>{(async()=>{if(!f){if(!x){console.log("Not authenticated, redirecting to login"),h("/login",{replace:!0});return}if(i&&!l)if(console.log("User authenticated but profile not loaded, attempting to fetch..."),await N(),l)console.log("Profile found after refresh:",l.role);else{console.log("Profile still not found - user needs to complete registration");return}if(l){const s=l.personal_id&&l.phone&&l.profile_complete;s&&l.role!=="volunteer"?(console.log("Profile complete with specific role, redirecting to dashboard:",l.role),h(v(),{replace:!0})):s&&l.role==="volunteer"&&console.log("User has initial volunteer role but needs to select specific role")}}})()},[x,l,f,h,v,i,N]),m.useEffect(()=>{i&&l&&y(a=>({...a,firstName:l.first_name||a.firstName,lastName:l.last_name||a.lastName,...l.personal_id&&{personalId:l.personal_id},...l.phone&&{phone:l.phone},...l.faculty&&{faculty:l.faculty},...l.gender&&{gender:l.gender},...l.role&&{role:l.role},...l.tl_team&&{tlTeam:l.tl_team}}))},[i,l]),m.useEffect(()=>{const a=setTimeout(()=>{f&&(console.warn("Auth loading timeout - forcing state"),x&&i&&console.log("Timeout: User is authenticated, allowing registration form"))},1e4);return()=>clearTimeout(a)},[f,x,i]);const g=(a,s)=>{y(d=>({...d,[a]:s})),u(d=>d.filter(o=>o.field!==a))};m.useEffect(()=>{r.role!=="team_leader"&&y(a=>({...a,tlTeam:""}))},[r.role]);const U=a=>!a||!a.trim()?"Gender is required":["male","female"].includes(a.trim().toLowerCase())?null:"Please select a valid gender",k=a=>{const s=[];if(a===1){const d=I(r.firstName,"First name");d&&s.push({field:"firstName",message:d});const o=I(r.lastName,"Last name");o&&s.push({field:"lastName",message:o});const c=Z(r.phone);c&&s.push({field:"phone",message:c});const P=ee(r.personalId);P&&s.push({field:"personalId",message:P}),r.faculty||s.push({field:"faculty",message:"Faculty is required"});const C=U(r.gender);C&&s.push({field:"gender",message:C})}return a===2&&(r.role||s.push({field:"role",message:"Please select a volunteer role"}),r.role==="team_leader"&&!r.tlTeam&&s.push({field:"tlTeam",message:"Please select which team you will lead"})),s},X=()=>{const a=k(n);if(a.length>0){u(a);return}u([]),n<2&&j(n+1)},B=()=>{n>1&&j(n-1)},M=async a=>{var d;a.preventDefault();const s=[1,2].flatMap(o=>k(o));if(s.length>0){u(s);const o=Math.min(...s.map(c=>["firstName","lastName","phone","personalId","faculty","gender"].includes(c.field)?1:["role","tlTeam"].includes(c.field)?2:1));j(o);return}S(!0),u([]),b(!0);try{if(!(i!=null&&i.id))throw new Error("User not authenticated");const o={id:i.id,first_name:r.firstName.trim(),last_name:r.lastName.trim(),phone:r.phone.trim(),personal_id:r.personalId.trim(),faculty:r.faculty,role:r.role,gender:r.gender,tl_team:r.tlTeam||null,profile_complete:!0,updated_at:new Date().toISOString()};console.log("🚀 Updating volunteer profile with specific role:",r.role);const{error:c}=await W.from("users_profiles").update(o).eq("id",i.id);if(c){console.error("❌ Profile update failed:",c),c.code==="23505"&&((d=c.message)!=null&&d.includes("personal_id"))?u([{field:"personalId",message:"This Personal ID is already registered. Please use a different ID."}]):u([{field:"general",message:"Failed to save profile. Please try again."}]),b(!1);return}console.log("✅ Profile updated successfully with role:",r.role),await N(),console.log("🎉 Volunteer registration completed successfully!"),b(!1),D(!0),setTimeout(()=>{h(v(),{replace:!0})},3e3)}catch(o){console.error("💥 Unexpected error during profile completion:",o),u([{field:"general",message:"An unexpected error occurred. Please try again or contact support if the problem persists."}]),b(!1)}finally{S(!1)}},t=a=>{var s;return(s=_.find(d=>d.field===a))==null?void 0:s.message},G=()=>e.jsxs("div",{className:"space-y-6 stagger-children",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"fade-in-blur",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",value:r.firstName,onChange:a=>g("firstName",a.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-300 ${t("firstName")?"border-red-300":"border-gray-300"}`,placeholder:"Enter your first name"}),t("firstName")&&e.jsx("p",{className:"mt-1 text-sm text-red-600 fade-in-blur",children:t("firstName")})]}),e.jsxs("div",{className:"fade-in-blur",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),e.jsx("input",{type:"text",value:r.lastName,onChange:a=>g("lastName",a.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-300 ${t("lastName")?"border-red-300":"border-gray-300"}`,placeholder:"Enter your last name"}),t("lastName")&&e.jsx("p",{className:"mt-1 text-sm text-red-600 fade-in-blur",children:t("lastName")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"fade-in-blur",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),e.jsx("input",{type:"tel",value:r.phone,onChange:a=>g("phone",a.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-300 ${t("phone")?"border-red-300":"border-gray-300"}`,placeholder:"01X-XXXXXXXX"}),t("phone")&&e.jsx("p",{className:"mt-1 text-sm text-red-600 fade-in-blur",children:t("phone")})]}),e.jsxs("div",{className:"fade-in-blur",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Personal ID *"}),e.jsx("input",{type:"text",value:r.personalId,onChange:a=>g("personalId",a.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-300 ${t("personalId")?"border-red-300":"border-gray-300"}`,placeholder:"14-digit Egyptian ID",maxLength:14}),t("personalId")&&e.jsx("p",{className:"mt-1 text-sm text-red-600 fade-in-blur",children:t("personalId")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"fade-in-blur",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Faculty *"}),e.jsxs("select",{value:r.faculty,onChange:a=>g("faculty",a.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-300 ${t("faculty")?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select faculty"}),ae.map(a=>e.jsx("option",{value:a,children:a},a))]}),t("faculty")&&e.jsx("p",{className:"mt-1 text-sm text-red-600 fade-in-blur",children:t("faculty")})]}),e.jsxs("div",{className:"fade-in-blur",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender *"}),e.jsxs("select",{value:r.gender,onChange:a=>g("gender",a.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-300 ${t("gender")?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select gender"}),L.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),t("gender")&&e.jsx("p",{className:"mt-1 text-sm text-red-600 fade-in-blur",children:t("gender")})]})]})]}),V=()=>e.jsxs("div",{className:"space-y-6 stagger-children",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-6 fade-in-blur",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(w,{className:"h-6 w-6 text-orange-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-orange-900",children:"Volunteer Role Selection"})]}),e.jsx("p",{className:"text-orange-800",children:"Please select the volunteer role you're interested in. This helps us assign you to the most suitable position."})]}),e.jsxs("div",{className:"fade-in-blur",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"Preferred Volunteer Role *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:A.map(a=>e.jsxs("label",{className:`relative flex cursor-pointer rounded-lg border p-4 focus:outline-none transition-all duration-300 ${r.role===a.value?"border-orange-500 bg-orange-50 transform scale-[1.02]":"border-gray-300 bg-white hover:bg-gray-50 smooth-hover"}`,children:[e.jsx("input",{type:"radio",name:"role",value:a.value,checked:r.role===a.value,onChange:s=>g("role",s.target.value),className:"sr-only"}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"font-medium text-gray-900",children:a.label})}),e.jsx("div",{className:`flex-shrink-0 transition-colors duration-300 ${r.role===a.value?"text-orange-600":"text-gray-300"}`,children:e.jsx(E,{className:"h-6 w-6"})})]})]},a.value))}),t("role")&&e.jsx("p",{className:"mt-2 text-sm text-red-600 fade-in-blur",children:t("role")})]}),r.role==="team_leader"&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 fade-in-scale",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(re,{className:"h-6 w-6 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Team Leadership"})]}),e.jsx("p",{className:"text-blue-800 mb-4",children:"As a Team Leader, please select which team you will be leading. This helps us organize the volunteer structure."}),e.jsxs("div",{className:"fade-in-blur",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Team to Lead *"}),e.jsxs("select",{value:r.tlTeam,onChange:a=>g("tlTeam",a.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300 ${t("tlTeam")?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select team"}),$.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),t("tlTeam")&&e.jsx("p",{className:"mt-1 text-sm text-red-600 fade-in-blur",children:t("tlTeam")})]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 fade-in-blur",children:e.jsxs("p",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"Note:"})," Specific role assignments and team placements will be confirmed by the event organizers after registration."]})})]}),z=()=>{switch(n){case 1:return G();case 2:return V();default:return null}};return f?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center fade-in-scale",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):R?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-white flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center border border-orange-100 fade-in-scale modal-content-blur",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 fade-in-scale",children:e.jsx(E,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4 fade-in-blur",children:"Profile Complete!"}),e.jsx("p",{className:"text-gray-600 mb-6 fade-in-blur",children:"Your volunteer profile has been completed successfully. Redirecting to your dashboard..."}),e.jsx("div",{className:"animate-pulse",children:e.jsx("p",{className:"text-orange-600 font-medium",children:"Redirecting..."})})]})}):e.jsxs("div",{className:"min-h-screen relative",children:[e.jsx(H,{isLoading:F,message:"Completing your volunteer profile..."}),e.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat z-0",style:{backgroundImage:'url("/images/careercenter.png")'},children:e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-10"})}),e.jsxs("div",{className:"relative z-10 py-8 px-4",children:[e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center mb-8 fade-in-up-blur",children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx(w,{className:"h-12 w-12 text-white mr-3 drop-shadow-lg"}),e.jsx("h1",{className:"text-4xl font-bold text-white drop-shadow-lg",children:"Complete Your Volunteer Profile"})]}),e.jsx("p",{className:"text-white drop-shadow",children:"Finish setting up your volunteer account"})]})}),e.jsxs("div",{className:"mb-8 fade-in-up-blur",children:[e.jsx("div",{className:"flex items-center max-w-2xl mx-auto",children:p.map((a,s)=>e.jsxs(Y.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 transition-all duration-300 ${n>=a.id?"bg-orange-500 border-orange-500 text-white transform scale-110":"bg-white border-gray-300 text-gray-400"}`,children:e.jsx(a.icon,{className:"w-5 h-5"})})}),s<p.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-2 transition-all duration-300 ${n>a.id?"bg-orange-500":"bg-gray-300"}`})]},a.id))}),e.jsx("div",{className:"flex justify-between max-w-2xl mx-auto mt-2",children:p.map(a=>e.jsx("div",{className:"text-xs text-center",style:{width:"200px"},children:e.jsx("span",{className:`transition-all duration-300 ${n>=a.id?"text-white font-medium drop-shadow transform scale-105":"text-white drop-shadow"}`,children:a.title})},a.id))})]}),e.jsxs("form",{onSubmit:M,className:"bg-white rounded-2xl shadow-2xl p-8 border border-orange-100 fade-in-up-blur modal-content-blur",children:[t("general")&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center fade-in-blur",children:[e.jsx(J,{className:"w-5 h-5 text-red-600 mr-3"}),e.jsx("p",{className:"text-red-700",children:t("general")})]}),e.jsxs("div",{className:"mb-8 fade-in-blur",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:p[n-1].title}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${n/2*100}%`}})})]}),e.jsx("div",{className:"stagger-children",children:z()}),e.jsxs("div",{className:"flex justify-between mt-8 pt-6 border-t border-gray-200 fade-in-blur",children:[e.jsx("button",{type:"button",onClick:B,disabled:n===1,className:`px-6 py-3 rounded-lg font-medium transition-all duration-300 ${n===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-200 text-gray-700 hover:bg-gray-300 smooth-hover transform hover:scale-105"}`,children:"Previous"}),n<2?e.jsxs("button",{type:"button",onClick:X,className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg font-medium hover:from-orange-600 hover:to-orange-700 transition-all duration-300 transform hover:scale-105 flex items-center smooth-hover",children:["Next",e.jsx(K,{className:"w-4 h-4 ml-2"})]}):e.jsx("button",{type:"submit",disabled:T,className:"px-8 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg font-medium hover:from-orange-600 hover:to-orange-700 transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center smooth-hover",children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Completing Profile..."]}):"Complete Profile"})]})]})]})]})};export{te as VolunteerRegistration};

import{m as Ze,u as es,r as t,j as e,c as j,C as ss,A as as,s as o,x as ts,U as te}from"./index-CTR9K_C5.js";import{D as ns,X as y,Q as ls,M as rs,B as is}from"./DashboardLayout-ChN58qoY.js";import{S as we,Q as os}from"./QRScanner-B8cxYmV7.js";import{P as cs}from"./plus-BiD-W4Rw.js";import"./heart-CbsRToVe.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=Ze("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),bs=()=>{const{profile:c}=es(),[k,C]=t.useState(!1),[q,ne]=t.useState("dashboard"),[_e,L]=t.useState(!1),[Q,le]=t.useState("scan"),[re,E]=t.useState(!1),[Se,G]=t.useState(""),[H,P]=t.useState([]),[ie,g]=t.useState(!1),[h,A]=t.useState(null),[ke,I]=t.useState(!1),[ms,R]=t.useState(!1),[oe,B]=t.useState(!1),[ce,de]=t.useState("attendance"),[Ce,F]=t.useState(!1),[Y,me]=t.useState(""),[X,ue]=t.useState(""),[M,xe]=t.useState(""),[N,J]=t.useState([]),[Ae,K]=t.useState(""),[he,v]=t.useState([]),[Me,fe]=t.useState(!1),[Te,$]=t.useState(!1),[T,w]=t.useState(5),[De,_]=t.useState(""),[W,z]=t.useState([]),[u,b]=t.useState(null),[ge,f]=t.useState(!1),[be,S]=t.useState(!1),[Z,pe]=t.useState("scan"),[ee,Pe]=t.useState([]),[i,je]=t.useState(null),[Ie,V]=t.useState(!1),[ye,Re]=t.useState(!1),[m,Be]=t.useState({inside_building:0,inside_event:0,total_attendees:0}),[O,se]=t.useState(null),r=(s,a)=>{se({type:s,message:a}),setTimeout(()=>se(null),5e3)},p=()=>c==null?void 0:c.tl_team,ae=async()=>{try{const s=p();if(!s)return;const{data:a,error:n}=await o.from("users_profiles").select("*").eq("role",s).order("first_name");!n&&a&&Pe(a)}catch(s){console.error("Error fetching team members:",s)}},Ne=async s=>{try{const a=new Date;a.setHours(0,0,0,0);const{data:n,error:l}=await o.from("attendances").select("*").eq("user_id",s).eq("scan_type","vol_attendance").gte("scanned_at",a.toISOString()).limit(1);return!!(!l&&n&&n.length>0)}catch(a){return console.error("Error checking attendance:",a),!1}},$e=async s=>{je(s);const a=await Ne(s.id);Re(a),V(!0)},Ue=s=>{b(s),w(5),S(!0),V(!1)},Le=async s=>{A(s);const a=await Ne(s.id);B(a),R(!0),I(!0),V(!1)},ve=async()=>{try{const{data:s,error:a}=await ts();!a&&s&&Be({inside_building:s.inside_building,inside_event:s.inside_event,total_attendees:s.total_attendees})}catch(s){console.error("Error fetching building stats:",s)}};t.useEffect(()=>{ve(),ae();const s=setInterval(ve,3e4);return()=>clearInterval(s)},[]);const Ee=async s=>{try{console.log("Processing QR data:",s);let a=null;if(s.includes("-")){const{data:l,error:d}=await o.from("users_profiles").select("*").eq("id",s.trim()).single();!d&&l&&(a=l)}else{const{data:l,error:d}=await o.from("users_profiles").select("*").eq("volunteer_id",s.trim()).single();!d&&l&&(a=l)}if(!a){r("error","Volunteer not found");return}const n=p();if(a.role!==n){r("error","Volunteer not in your team");return}if(E(!1),ce==="bonus")b(a),S(!0);else{const l=new Date;l.setHours(0,0,0,0);const{data:d,error:x}=await o.from("attendances").select("*").eq("user_id",a.id).eq("scan_type","vol_attendance").gte("scanned_at",l.toISOString()).limit(1);!x&&d&&d.length>0?B(!0):B(!1),A(a),R(!0),I(!0)}}catch(a){console.error("QR scan error:",a),r("error","Failed to process QR code")}},Fe=async s=>{if(!s.trim()){P([]),g(!1);return}try{const a=p();if(!a){r("error","No team assigned");return}const{data:n,error:l}=await o.from("users_profiles").select("*").or(`personal_id.ilike.%${s}%,volunteer_id.ilike.%${s}%,first_name.ilike.%${s}%,last_name.ilike.%${s}%`).eq("role",a).limit(10);!l&&n?(P(n),g(!0)):(P([]),g(!1))}catch(a){console.error("Search error:",a),P([]),g(!1)}},ze=async()=>{if(h)try{C(!0);const{error:s}=await o.from("attendances").insert([{user_id:h.id,scan_type:"vol_attendance",scanned_by:c==null?void 0:c.id}]);if(s){r("error","Failed to record attendance");return}r("success","Attendance recorded successfully!"),I(!1),A(null),R(!1),L(!1),ae()}catch(s){console.error("Attendance action error:",s),r("error","Failed to record attendance")}finally{C(!1)}},Ve=async s=>{if(!s||s.trim().length<2){v([]);return}fe(!0);try{const a=p();if(!a){v([]);return}const{data:n,error:l}=await o.from("users_profiles").select("id, first_name, last_name, personal_id, role, email, volunteer_id, tl_team").or(`personal_id.ilike.%${s.trim()}%,volunteer_id.ilike.%${s.trim()}%,first_name.ilike.%${s.trim()}%,last_name.ilike.%${s.trim()}%`).eq("role",a).order("volunteer_id").limit(10);if(l)console.error("Search error:",l),v([]);else{const d=(n||[]).filter(x=>!N.some(D=>D.id===x.id)&&x.id!==(c==null?void 0:c.id));v(d)}}catch(a){console.error("Search exception:",a),v([])}finally{fe(!1)}},Oe=s=>{J(a=>[...a,s]),v(a=>a.filter(n=>n.id!==s.id)),K("")},qe=s=>{J(a=>a.filter(n=>n.id!==s))},U=()=>{J([]),K(""),v([])},Qe=async()=>{if(!Y||!X||!M){r("error","Please fill all required fields!");return}if(console.log("=== DEBUG ANNOUNCEMENT ==="),console.log("announcementRole:",M),console.log("getTeamLeaderTeam():",p()),console.log("selectedUsers count:",N.length),console.log("======================"),M==="custom"&&N.length===0){r("error","Please select at least one user for custom announcements!");return}C(!0);try{let s,a=null,n=null;if(M==="custom")s="specific_users",n=N.map(D=>D.id);else{const D=p();if(!D){r("error","No team assigned");return}s="role",a=D}console.log("Calling send_notification RPC with:",{targetType:s,targetRole:a,targetUserIds:n});const l={title_param:Y,message_param:X,target_type_param:s};a&&(l.target_role_param=a),n&&n.length>0&&(l.target_user_ids_param=n);const{data:d,error:x}=await o.rpc("send_notification",l);x?(console.error("Notification RPC error:",x),r("error","Failed to send announcement: "+x.message)):(console.log("SUCCESS - Notification sent with ID:",d),r("success","Announcement sent successfully!"),F(!1),me(""),ue(""),xe(""),U())}catch(s){console.error("Send announcement error:",s),r("error","Failed to send announcement")}finally{C(!1)}},Ge=async s=>{if(!s.trim()){z([]),f(!1);return}try{const a=p();if(!a){r("error","No team assigned");return}const{data:n,error:l}=await o.from("users_profiles").select("*").or(`personal_id.ilike.%${s}%,volunteer_id.ilike.%${s}%,first_name.ilike.%${s}%,last_name.ilike.%${s}%`).eq("role",a).limit(10);if(!l&&n){const d=n.filter(x=>x.id!==(c==null?void 0:c.id));z(d),f(!0)}else z([]),f(!1)}catch(a){console.error("Search error:",a),z([]),f(!1)}},He=async()=>{if(!u||T<1||T>30){r("error","Please select a user and set bonus amount (1-30)");return}C(!0);try{const{error:s}=await o.from("user_scores").insert([{user_id:u.id,points:T,activity_type:"vol_bonus",activity_description:"Bonus points assigned by team leader"}]);if(s)r("error","Failed to assign bonus");else{const{data:a}=await o.from("users_profiles").select("score").eq("id",u.id).single();a&&await o.from("users_profiles").update({score:(a.score||0)+T}).eq("id",u.id),r("success",`Bonus of ${T} points assigned successfully!`),$(!1),b(null),_(""),w(5),S(!1),ae()}}catch{r("error","Failed to assign bonus")}finally{C(!1)}},Ye=()=>{const s=p();return s?[{value:s,label:{volunteer:"Volunteers",registration:"Registration Team",building:"Building Team",info_desk:"Info Desk Team",team_leader:"Team Leaders",ushers:"Ushers",marketing:"Marketing Team",media:"Media Team",ER:"ER Team",BD:"BD Team",catering:"Catering Team",feedback:"Feedback Team",stage:"Stage Team"}[s]||s},{value:"custom",label:"Custom Selection"}]:[]},Xe=()=>{de("attendance"),E(!0),L(!1)},Je=()=>{de("bonus"),E(!0),$(!1)},Ke=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 fade-in-blur card-hover dashboard-card",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(te,{className:"h-8 w-8 text-orange-500"}),"Your Team (",ee.length," members)"]})}),ee.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No team members found."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 stagger-children",children:ee.map(s=>e.jsxs("div",{onClick:()=>$e(s),className:"bg-white border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all duration-300 cursor-pointer smooth-hover card-hover",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-orange-600 font-bold text-lg",children:[s.first_name[0],s.last_name[0]]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Score"}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:s.score||0})]})]}),e.jsxs("h3",{className:"font-bold text-gray-900 text-lg mb-1",children:[s.first_name," ",s.last_name]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",s.volunteer_id]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Personal ID:"})," ",s.personal_id]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.phone&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",s.phone]}),s.faculty&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Faculty:"})," ",s.faculty]})]})]},s.id))})]})}),We=()=>e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 fade-in-blur card-hover dashboard-card",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2 mb-8",children:[e.jsx(te,{className:"h-8 w-8 text-orange-500"}),"Manage Your Team"]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-center stagger-children",children:[e.jsxs("button",{onClick:()=>L(!0),className:"flex-1 flex flex-col items-center justify-center py-6 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-all duration-300 smooth-hover",children:[e.jsx(ls,{className:"h-8 w-8 mb-2"}),e.jsx("span",{className:"text-base font-medium",children:"Mark Attendance"})]}),e.jsxs("button",{onClick:()=>$(!0),className:"flex-1 flex flex-col items-center justify-center py-6 px-4 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-all duration-300 smooth-hover",children:[e.jsx(ds,{className:"h-8 w-8 mb-2"}),e.jsx("span",{className:"text-base font-medium",children:"Assign Bonus"})]}),e.jsxs("button",{onClick:()=>F(!0),className:"flex-1 flex flex-col items-center justify-center py-6 px-4 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition-all duration-300 smooth-hover",children:[e.jsx(rs,{className:"h-8 w-8 mb-2"}),e.jsx("span",{className:"text-base font-medium",children:"Send Announcement"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden fade-in-blur card-hover dashboard-card",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50",children:e.jsxs("h2",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2 mx-auto",children:[e.jsx(is,{className:"h-7 w-7 text-orange-500"}),"Flow Dashboard"]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 px-6 py-6 text-center stagger-children",children:[e.jsxs("div",{className:"bg-green-100 p-4 rounded-lg shadow-sm card-hover smooth-hover",children:[e.jsx("p",{className:"text-2xl font-bold text-green-900",children:m.inside_building}),e.jsx("p",{className:"text-lg font-bold text-gray-700",children:"Inside Building"})]}),e.jsxs("div",{className:"bg-teal-100 p-4 rounded-lg shadow-sm card-hover smooth-hover",children:[e.jsx("p",{className:"text-2xl font-bold text-teal-900",children:m.inside_event}),e.jsx("p",{className:"text-lg font-bold text-gray-700",children:"Inside Event"})]}),e.jsxs("div",{className:"bg-blue-100 p-4 rounded-lg shadow-sm card-hover smooth-hover",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:m.total_attendees}),e.jsx("p",{className:"text-lg font-bold text-gray-700",children:"Total Attendees"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-lg font-bold text-left border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-800 text-xl font-extrabold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Site"}),e.jsx("th",{className:"px-4 py-3",children:"Maximum Capacity"}),e.jsx("th",{className:"px-4 py-3",children:"Current Capacity"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:"Building"}),e.jsx("td",{className:"px-4 py-3 text-red-600",children:"500"}),e.jsxs("td",{className:"px-4 py-3",children:[m.inside_building>0?Math.round(m.inside_building/500*100):0,"%"]})]}),e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:"Event"}),e.jsx("td",{className:"px-4 py-3 text-red-600",children:"4000"}),e.jsxs("td",{className:"px-4 py-3",children:[m.inside_event>0?Math.round(m.inside_event/4e3*100):0,"%"]})]}),e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:"Total"}),e.jsx("td",{className:"px-4 py-3 text-red-600",children:"4500"}),e.jsxs("td",{className:"px-4 py-3",children:[m.inside_building+m.inside_event>0?Math.round((m.inside_building+m.inside_event)/4500*100):0,"%"]})]})]})]})})})]})]});return e.jsx(ns,{title:"Team Leader Dashboard",subtitle:"Manage your team, track attendance, and assign bonuses",children:e.jsxs("div",{className:"fade-in-up-blur relative",children:[e.jsxs("div",{className:"flex space-x-1 mb-8 bg-gray-100 p-1 rounded-xl w-fit mx-auto",children:[e.jsx("button",{onClick:()=>ne("dashboard"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-300 ${q==="dashboard"?"bg-white text-orange-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Dashboard"}),e.jsx("button",{onClick:()=>ne("team"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-300 ${q==="team"?"bg-white text-orange-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Team"})]}),O&&j.createPortal(e.jsxs("div",{className:`fixed top-4 right-4 z-[200] flex items-center space-x-2 px-4 py-3 rounded-lg shadow-lg fade-in-blur ${O.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:[O.type==="success"?e.jsx(ss,{className:"h-5 w-5"}):e.jsx(as,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:O.message}),e.jsx("button",{onClick:()=>se(null),className:"ml-2 hover:bg-black hover:bg-opacity-20 rounded p-1 transition-colors",children:e.jsx(y,{className:"h-4 w-4"})})]}),document.body),q==="dashboard"?We():Ke(),Ie&&i&&j.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[200] p-4 modal-backdrop-blur",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content-blur fade-in-up-blur",children:e.jsxs("div",{className:"p-6 stagger-children",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 fade-in-blur",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Team Member Details"}),e.jsx("button",{onClick:()=>{V(!1),je(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(y,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-4 fade-in-blur",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-orange-600 font-bold text-xl",children:[i.first_name[0],i.last_name[0]]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900",children:[i.first_name," ",i.last_name]}),e.jsxs("p",{className:"text-gray-600",children:["Volunteer ID: ",i.volunteer_id]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Personal ID"}),e.jsx("p",{className:"text-gray-900",children:i.personal_id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Score"}),e.jsx("p",{className:"text-orange-600 font-bold",children:i.score||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Email"}),e.jsx("p",{className:"text-gray-900 truncate",children:i.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Attendance Today"}),e.jsx("p",{className:ye?"text-green-600 font-bold":"text-red-600 font-bold",children:ye?"Present":"Absent"})]}),i.phone&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Phone"}),e.jsx("p",{className:"text-gray-900",children:i.phone})]}),i.faculty&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Faculty"}),e.jsx("p",{className:"text-gray-900",children:i.faculty})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 fade-in-blur",children:[e.jsx("button",{onClick:()=>Ue(i),className:"flex-1 bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-all duration-300 font-medium",children:"Assign Bonus"}),e.jsx("button",{onClick:()=>Le(i),className:"flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-all duration-300 font-medium",children:"Mark Attendance"})]})]})]})})}),document.body),_e&&j.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[200] p-4 modal-backdrop-blur",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content-blur fade-in-up-blur",children:e.jsxs("div",{className:"p-6 stagger-children",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 fade-in-blur",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Mark Attendance"}),e.jsx("button",{onClick:()=>{L(!1),A(null),R(!1),G(""),P([]),g(!1)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(y,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"flex gap-2 mb-4 fade-in-blur",children:[e.jsx("button",{onClick:()=>le("scan"),className:`flex-1 py-2 px-4 rounded-lg transition-all duration-300 ${Q==="scan"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,children:"QR Scanner"}),e.jsx("button",{onClick:()=>le("search"),className:`flex-1 py-2 px-4 rounded-lg transition-all duration-300 ${Q==="search"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,children:"Search"})]}),Q==="scan"?e.jsx("div",{className:"space-y-4 fade-in-blur",children:e.jsx("button",{onClick:Xe,className:"w-full bg-blue-500 text-white py-3 px-4 rounded-lg hover:bg-blue-600 transition-all duration-300 font-medium",children:"Open QR Scanner"})}):e.jsxs("div",{className:"space-y-4 fade-in-blur",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Se,onChange:s=>{G(s.target.value),Fe(s.target.value)},onFocus:()=>{H.length>0&&g(!0)},placeholder:"Search by Personal ID, Volunteer ID, or Name",className:"w-full border rounded-lg px-3 py-2 pr-10 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300"}),e.jsx(we,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400"}),ie&&H.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-40 max-h-60 overflow-y-auto",children:H.map(s=>e.jsx("button",{onClick:async()=>{A(s),G(`${s.first_name} ${s.last_name} (${s.volunteer_id})`),g(!1);const a=new Date;a.setHours(0,0,0,0);const{data:n,error:l}=await o.from("attendances").select("*").eq("user_id",s.id).eq("scan_type","vol_attendance").gte("scanned_at",a.toISOString()).limit(1);!l&&n&&n.length>0?B(!0):B(!1),I(!0)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0 transition-all duration-300",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",s.volunteer_id," | Personal ID: ",s.personal_id]}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s.role.replace("_"," ")})]})},s.id))})]}),ie&&e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>g(!1)})]})]})})}),document.body),re&&j.createPortal(e.jsx(os,{isOpen:re,onClose:()=>E(!1),onScan:Ee,title:ce==="attendance"?"Attendance Scanner":"Bonus Assignment Scanner",description:"Point your camera at the volunteer's QR code"}),document.body),ke&&h&&j.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[200] p-4 modal-backdrop-blur",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content-blur fade-in-up-blur",children:e.jsxs("div",{className:"p-6 stagger-children",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 fade-in-blur",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Volunteer Information"}),e.jsx("button",{onClick:()=>{I(!1),A(null),R(!1)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(y,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-3 fade-in-blur",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsxs("span",{children:[h.first_name," ",h.last_name]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Volunteer ID:"}),e.jsx("span",{children:h.volunteer_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{children:h.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Personal ID:"}),e.jsx("span",{children:h.personal_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Role:"}),e.jsx("span",{className:"capitalize",children:h.role.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Today's Attendance:"}),oe?e.jsx("span",{className:"text-red-600 font-semibold",children:"Already Marked"}):e.jsx("span",{className:"text-green-600 font-semibold",children:"Not Marked"})]})]}),e.jsx("div",{className:"mt-6 fade-in-blur",children:oe?e.jsx("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg",children:e.jsx("p",{className:"font-medium text-center",children:"Attendance already taken today"})}):e.jsx("button",{onClick:ze,disabled:k,className:"w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 disabled:opacity-50 transition-all duration-300 font-medium",children:k?"Recording...":"Mark Attendance"})})]})})}),document.body),Ce&&j.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[200] p-4 modal-backdrop-blur",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto modal-content-blur fade-in-up-blur",children:e.jsxs("div",{className:"p-6 stagger-children",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 fade-in-blur",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Send Announcement"}),e.jsx("button",{onClick:()=>{F(!1),U()},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(y,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"fade-in-blur",children:e.jsx("input",{type:"text",value:Y,onChange:s=>me(s.target.value),placeholder:"Message Title",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300"})}),e.jsx("div",{className:"fade-in-blur",children:e.jsx("textarea",{value:X,onChange:s=>ue(s.target.value),placeholder:"Message Description",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300",rows:3})}),e.jsx("div",{className:"fade-in-blur",children:e.jsxs("select",{value:M,onChange:s=>{xe(s.target.value),s.target.value!=="custom"&&U()},className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300",children:[e.jsx("option",{value:"",children:"Select Target"}),Ye().map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})}),M==="custom"&&e.jsxs("div",{className:"space-y-3 fade-in-blur",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ae,onChange:s=>{K(s.target.value),Ve(s.target.value)},placeholder:"Search by Personal ID, Volunteer ID, or Name...",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300"}),Me&&e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})})]}),he.length>0&&e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-lg fade-in-blur",children:he.map(s=>e.jsx("div",{onClick:()=>Oe(s),className:"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0 transition-all duration-300",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Vol ID: ",s.volunteer_id," | Personal ID: ",s.personal_id]})]}),e.jsx(cs,{className:"h-4 w-4 text-blue-500"})]})},s.id))}),N.length>0&&e.jsxs("div",{className:"fade-in-blur",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Selected Users (",N.length,")"]}),e.jsx("button",{onClick:U,className:"text-xs text-red-500 hover:text-red-700 transition-colors",children:"Clear All"})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-lg bg-gray-50",children:N.map(s=>e.jsxs("div",{className:"p-2 flex justify-between items-center border-b last:border-b-0",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",s.personal_id]})]}),e.jsx("button",{onClick:()=>qe(s.id),className:"text-red-500 hover:text-red-700 transition-colors",children:e.jsx(y,{className:"h-4 w-4"})})]},s.id))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 fade-in-blur",children:[e.jsx("button",{onClick:()=>{F(!1),U()},className:"px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition-all duration-300",children:"Cancel"}),e.jsx("button",{onClick:Qe,disabled:k,className:"px-4 py-2 rounded-lg bg-purple-500 text-white hover:bg-purple-600 disabled:opacity-50 transition-all duration-300",children:k?"Sending...":"Send"})]})]})})}),document.body),Te&&j.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[200] p-4 modal-backdrop-blur",onClick:()=>{be||($(!1),b(null),_(""),f(!1),w(5))},children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content-blur fade-in-up-blur",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"p-6 stagger-children",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 fade-in-blur",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Assign Bonus Points"}),e.jsx("button",{onClick:()=>{$(!1),b(null),_(""),f(!1),w(5),S(!1)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(y,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"flex gap-2 mb-4 fade-in-blur",children:[e.jsx("button",{onClick:()=>pe("scan"),className:`flex-1 py-2 px-4 rounded-lg transition-all duration-300 ${Z==="scan"?"bg-green-500 text-white":"bg-gray-200 text-gray-700"}`,children:"QR Scanner"}),e.jsx("button",{onClick:()=>pe("search"),className:`flex-1 py-2 px-4 rounded-lg transition-all duration-300 ${Z==="search"?"bg-green-500 text-white":"bg-gray-200 text-gray-700"}`,children:"Search"})]}),Z==="scan"?e.jsx("div",{className:"space-y-4 fade-in-blur",children:e.jsx("button",{onClick:Je,className:"w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 transition-all duration-300 font-medium",children:"Open QR Scanner"})}):e.jsxs("div",{className:"space-y-4 fade-in-blur",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:De,onChange:s=>{_(s.target.value),Ge(s.target.value)},onFocus:()=>{W.length>0&&f(!0)},placeholder:"Search by Personal ID, Volunteer ID, or Name",className:"w-full border rounded-lg px-3 py-2 pr-10 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300"}),e.jsx(we,{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400"}),ge&&W.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-40 max-h-60 overflow-y-auto",children:W.map(s=>e.jsx("button",{onClick:()=>{b(s),_(`${s.first_name} ${s.last_name} (${s.volunteer_id})`),f(!1),S(!0)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0 transition-all duration-300",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",s.volunteer_id," | Personal ID: ",s.personal_id]}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s.role.replace("_"," ")})]})},s.id))})]}),ge&&e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>f(!1)})]})]})})}),document.body),be&&u&&j.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[200] p-4 modal-backdrop-blur",onClick:()=>{S(!1),b(null),_(""),w(5)},children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content-blur fade-in-up-blur",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"p-6 stagger-children",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 fade-in-blur",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Assign Bonus"}),e.jsx("button",{onClick:()=>{S(!1),b(null),_(""),w(5)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(y,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-3 mb-4 fade-in-blur",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsxs("span",{children:[u.first_name," ",u.last_name]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Volunteer ID:"}),e.jsx("span",{children:u.volunteer_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Personal ID:"}),e.jsx("span",{children:u.personal_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Role:"}),e.jsx("span",{className:"capitalize",children:u.role.replace("_"," ")})]})]}),e.jsxs("div",{className:"mb-6 fade-in-blur",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bonus Points (1-30)"}),e.jsx("input",{type:"number",min:"1",max:"30",value:T,onChange:s=>w(Math.min(30,Math.max(1,parseInt(s.target.value)||1))),className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300"})]}),e.jsx("div",{className:"fade-in-blur",children:e.jsx("button",{onClick:He,disabled:k,className:"w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 disabled:opacity-50 transition-all duration-300 font-medium",children:k?"Assigning...":"Give Bonus"})})]})})}),document.body)]})})};export{bs as TeamLeaderDashboard};

import{o as N,r as x,s as v,j as e,d as w,U as S}from"./index-Cj-T6Nn4.js";import{X as $,a as I,C as L,U}from"./DashboardLayout-C3lQ1M3v.js";import{M as B}from"./map-pin-CGJaJU9m.js";import{C as D}from"./clock-ur7lrMmp.js";import{U as M,a as R}from"./user-x-nU9yeE1N.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=N("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=N("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),P=l=>{switch(l.toLowerCase()){case"admin":case"sadmin":return e.jsx(L,{className:"h-8 w-8 text-yellow-500"});case"team_leader":case"registration":case"building":case"info_desk":return e.jsx(I,{className:"h-8 w-8 text-blue-500"});case"volunteer":return e.jsx(S,{className:"h-8 w-8 text-green-500"});default:return e.jsx(w,{className:"h-8 w-8 text-gray-500"})}},q=l=>{switch(l.toLowerCase()){case"admin":case"sadmin":return"bg-yellow-100 text-yellow-800";case"team_leader":case"registration":case"building":case"info_desk":return"bg-blue-100 text-blue-800";case"volunteer":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},X=l=>l.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()),Q=({isOpen:l,onClose:o,attendee:u,onAction:_,loading:c=!1,mode:t="building",sessionTitle:g})=>{const[r,b]=x.useState(null),[s,h]=x.useState(u);if(x.useEffect(()=>{if(!(s!=null&&s.id))return;console.log("Setting up real-time subscription for attendee:",s.id);const n=v.channel(`attendee_${s.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"users_profiles",filter:`id=eq.${s.id}`},i=>{console.log("Real-time status update:",i),i.new&&h(a=>a?{...a,building_entry:i.new.building_entry,event_entry:i.new.event_entry,building_status:i.new.building_entry?"inside_building":"outside_building",current_status:i.new.event_entry?"inside_event":"outside_event"}:null)}).subscribe();return()=>{console.log("Cleaning up subscription"),v.removeChannel(n)}},[s==null?void 0:s.id]),x.useEffect(()=>{h(u)},[u]),!l||!s)return null;const m=async n=>{b(n);try{await _(n)}finally{b(null)}},k=n=>n?new Date(n).toLocaleString():"Never",C=()=>t==="session"?"Add to Session":"Attendee Details",E=()=>t==="building"?s.building_entry?"inside":"outside":t==="registration"&&s.event_entry?"inside":"outside",f=()=>t==="building"?s.building_entry?"Inside Building":"Outside Building":s.event_entry?"Inside Event":"Outside Event",j=()=>{let n=!1;return t==="building"?n=s.building_entry||!1:n=s.event_entry||!1,n?"bg-green-100 text-green-800":"bg-red-100 text-red-800"},A=()=>{if(t==="session"){const d=s.building_entry;return e.jsxs("div",{className:"pt-4",children:[!d&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Attendee must be inside the building to join a session"})]})}),e.jsx("button",{onClick:()=>m("enter"),disabled:c||r!==null||!d,className:`w-full flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-colors ${d?r==="enter"?"bg-green-100 text-green-700 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:r==="enter"?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-600"}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-5 w-5"}),e.jsx("span",{children:d?"Add to Session":"Cannot Add to Session"})]})}),g&&e.jsx("p",{className:"text-sm text-gray-600 text-center mt-2",children:d?e.jsxs(e.Fragment,{children:["Adding to: ",e.jsx("span",{className:"font-medium",children:g})]}):e.jsxs("span",{className:"text-red-600",children:["Session: ",g]})}),e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${s.building_entry?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-2 ${s.building_entry?"bg-green-500":"bg-red-500"}`}),s.building_entry?"Inside Building":"Outside Building"]})})]})}const i=E()==="inside";let a=i||c||r!==null,p="";t==="building"&&(s.event_entry||(a=!0,p="Must be inside event first"));const y=!i||c||r!==null;return e.jsxs("div",{className:"space-y-3",children:[t==="building"&&!s.event_entry&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-amber-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsx("p",{className:"text-sm text-amber-800 font-medium",children:"Attendee must be inside event before entering building"})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>m("enter"),disabled:a,title:p,className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-colors ${a?"bg-gray-200 text-gray-400 cursor-not-allowed":r==="enter"?"bg-green-100 text-green-700 cursor-not-allowed":"bg-green-500 hover:bg-green-600 text-white"}`,children:r==="enter"?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-600"}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx("span",{children:"Enter"})]})}),e.jsx("button",{onClick:()=>m("exit"),disabled:y,className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-medium transition-colors ${y?"bg-gray-200 text-gray-400 cursor-not-allowed":r==="exit"?"bg-red-100 text-red-700 cursor-not-allowed":"bg-red-500 hover:bg-red-600 text-white"}`,children:r==="exit"?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-red-600"}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-5"}),e.jsx("span",{children:"Exit"})]})})]})]})};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto modal-content-blur",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:C()}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",disabled:c||r!==null,children:e.jsx($,{className:"h-5 w-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-gray-50 rounded-full",children:P(s.role)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:[s.first_name," ",s.last_name]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1 flex-wrap",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${q(s.role)}`,children:X(s.role)}),t==="building"&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.event_entry?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${s.event_entry?"bg-blue-500":"bg-gray-500"}`}),s.event_entry?"Inside Event":"Outside Event"]}),e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j()}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${s.building_entry?"bg-green-500":"bg-red-500"}`}),f()]})]}),t!=="building"&&e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j()}`,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${t==="registration"?s.event_entry?"bg-green-500":"bg-red-500":s.building_entry?"bg-green-500":"bg-red-500"}`}),t==="session"?s.building_entry?"Inside Building":"Outside Building":f()]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(O,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(F,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s.phone})]}),e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(w,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded",children:["ID: ",s.personal_id]})]}),s.university&&e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(B,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:s.university}),s.faculty&&e.jsx("div",{className:"text-gray-500 text-xs",children:s.faculty})]})]}),s.last_scan&&t==="building"&&e.jsxs("div",{className:"flex items-center space-x-3 text-gray-600",children:[e.jsx(D,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("div",{className:"text-sm",children:e.jsxs("div",{children:["Last Scan: ",k(s.last_scan)]})})]})]}),A(),(t==="building"||t==="registration")&&e.jsx("div",{className:"text-xs text-gray-500 text-center bg-gray-50 p-3 rounded-lg",children:t==="building"?e.jsxs("p",{children:[e.jsx("strong",{children:"Building Entry Requirements:"}),e.jsx("br",{}),"1. Must be inside event first",e.jsx("br",{}),"2. Must be outside building",e.jsx("br",{}),e.jsx("strong",{children:"Exit:"})," Available when inside building"]}):e.jsxs("p",{children:[e.jsx("strong",{children:"Enter:"})," Available when outside event •",e.jsx("strong",{children:"Exit:"})," Available when inside event"]})})]})]})};export{Q as A};
